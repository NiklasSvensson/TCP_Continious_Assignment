name: Upload Release Asset

on:

  # Trigger the workflow on push or pull request,

  # but only for the master branch

  push:

    branches:

      - master

jobs:

  build:

    name: Upload Release Asset

    runs-on: windows-latest

    steps:

      - name: Checkout code

        uses: actions/checkout@master

      - name: Set up Python 3.8
        uses: actions/setup-python@v1
        with:
          python-version: 3.8
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pyinstaller

      - name: Creating distribution Server
        working-directory: ./Server
        run: |
          pyinstaller server.py
          mv dist dist-server
          mv dist-server ..
      - name: Creating distribution Client
        working-directory: ./Client
        run: |
          pyinstaller client.py
          mv dist dist-client
          mv dist-client ..
      - name: move files to release folder
        run: |
          mkdir release
          mv -v dist-server ./release
          mv -v dist-client ./release
      - name: Move to release
        run: 
          powershell.exe compress-archive release release
      - name: Release to github
        uses: svenstaro/upload-release-action@v1-release
        with:
          repo_token: ${{secrets.GITHUB_TOKEN}}
          file: release.zip
          asset_name: server-client
          tag: ${{ github.ref }}
          overwrite: true